{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user of the ValuScan platform.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user.",
          "format": "uuid"
        },
        "email": {
          "type": "string",
          "description": "Email address of the user.",
          "format": "email"
        },
        "username": {
          "type": "string",
          "description": "Username of the user."
        },
        "firstName": {
          "type": "string",
          "description": "First name of the user."
        },
        "lastName": {
          "type": "string",
          "description": "Last name of the user."
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp of when the user account was created.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "email",
        "username",
        "firstName",
        "lastName",
        "createdAt"
      ]
    },
    "Item": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Item",
      "type": "object",
      "description": "Represents an item listed on the ValuScan marketplace.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the item.",
          "format": "uuid"
        },
        "userId": {
          "type": "string",
          "description": "Reference to the User who listed this item. (Relationship: User 1:N Item)"
        },
        "title": {
          "type": "string",
          "description": "Title of the item."
        },
        "description": {
          "type": "string",
          "description": "Description of the item."
        },
        "price": {
          "type": "number",
          "description": "Price of the item."
        },
        "imageUrl": {
          "type": "string",
          "description": "URL of the image for the item.",
          "format": "uri"
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp of when the item was listed.",
          "format": "date-time"
        },
        "category": {
          "type": "string",
          "description": "Category of the item."
        }
      },
      "required": [
        "id",
        "userId",
        "title",
        "description",
        "price",
        "imageUrl",
        "createdAt",
        "category"
      ]
    },
    "Sale": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Sale",
      "type": "object",
      "description": "Represents a sale of an item on the ValuScan marketplace.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the sale.",
          "format": "uuid"
        },
        "itemId": {
          "type": "string",
          "description": "Reference to the Item that was sold. (Relationship: Item 1:N Sale)"
        },
        "buyerId": {
          "type": "string",
          "description": "Reference to the User who purchased the item. (Relationship: User 1:N Sale)"
        },
        "saleDate": {
          "type": "string",
          "description": "Date of the sale.",
          "format": "date-time"
        },
        "salePrice": {
          "type": "number",
          "description": "Price at which the item was sold."
        },
        "commissionAmount": {
          "type": "number",
          "description": "Commission amount charged for the sale."
        }
      },
      "required": [
        "id",
        "itemId",
        "buyerId",
        "saleDate",
        "salePrice",
        "commissionAmount"
      ]
    },
    "Pickup": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Pickup",
      "type": "object",
      "description": "Represents a pickup request for a sold item.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the pickup request.",
          "format": "uuid"
        },
        "saleId": {
          "type": "string",
          "description": "Reference to the Sale for which the pickup is requested. (Relationship: Sale 1:N Pickup)"
        },
        "pickupDate": {
          "type": "string",
          "description": "Date and time of the scheduled pickup.",
          "format": "date-time"
        },
        "address": {
          "type": "string",
          "description": "Address where the item needs to be picked up."
        },
        "status": {
          "type": "string",
          "description": "Status of the pickup request (e.g., requested, scheduled, completed)."
        }
      },
      "required": [
        "id",
        "saleId",
        "pickupDate",
        "address",
        "status"
      ]
    },
    "EthicalContribution": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "EthicalContribution",
      "type": "object",
      "description": "Represents an ethical funding contribution made by a user.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the contribution.",
          "format": "uuid"
        },
        "saleId": {
          "type": "string",
          "description": "Reference to the Sale for which the contribution is made. (Relationship: Sale 1:N EthicalContribution)"
        },
        "amount": {
          "type": "number",
          "description": "Amount of the ethical contribution."
        },
        "contributionDate": {
          "type": "string",
          "description": "Date of the contribution.",
          "format": "date-time"
        },
        "campaignName": {
          "type": "string",
          "description": "Name of the ethical campaign the contribution is for."
        }
      },
      "required": [
        "id",
        "saleId",
        "amount",
        "contributionDate",
        "campaignName"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user profiles. Path-based ownership for private user data.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/items/{itemId}",
        "definition": {
          "entityName": "Item",
          "schema": {
            "$ref": "#/backend/entities/Item"
          },
          "description": "Stores items listed by a specific user. Facilitates simple security rules based on the user ID.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            },
            {
              "name": "itemId",
              "description": "The unique identifier for the item."
            }
          ]
        }
      },
      {
        "path": "/items/{itemId}",
        "definition": {
          "entityName": "Item",
          "schema": {
            "$ref": "#/backend/entities/Item"
          },
          "description": "This collection contains all items listed on the marketplace to support efficient listing and discovery. Includes denormalized 'userId' from the parent `/users/{userId}/items/{itemId}` collection to enable list operations based on the user. It denormalizes `userId` for authorization independence.",
          "params": [
            {
              "name": "itemId",
              "description": "The unique identifier for the item."
            }
          ]
        }
      },
      {
        "path": "/sales/{saleId}",
        "definition": {
          "entityName": "Sale",
          "schema": {
            "$ref": "#/backend/entities/Sale"
          },
          "description": "Sales data is stored in a top-level collection to allow for efficient querying and aggregation of sales data across all users. It includes denormalized `itemId`, `buyerId` and `userId` (seller) for authorization independence. This also facilitates reporting and analytics on sales trends.",
          "params": [
            {
              "name": "saleId",
              "description": "The unique identifier for the sale."
            }
          ]
        }
      },
      {
        "path": "/pickups/{pickupId}",
        "definition": {
          "entityName": "Pickup",
          "schema": {
            "$ref": "#/backend/entities/Pickup"
          },
          "description": "Pickup requests are stored in a top-level collection, as they involve interactions between buyers, sellers, and potentially delivery services. Includes denormalized `saleId` for authorization independence.",
          "params": [
            {
              "name": "pickupId",
              "description": "The unique identifier for the pickup."
            }
          ]
        }
      },
      {
        "path": "/ethical_contributions/{contributionId}",
        "definition": {
          "entityName": "EthicalContribution",
          "schema": {
            "$ref": "#/backend/entities/EthicalContribution"
          },
          "description": "Ethical contributions are stored in a top-level collection for reporting and tracking purposes. Includes denormalized `saleId` for authorization independence.",
          "params": [
            {
              "name": "contributionId",
              "description": "The unique identifier for the contribution."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to support the ValuScan application, focusing on user-owned data and marketplace functionalities. The core principle is Authorization Independence, achieved through denormalization of user IDs in subcollections, avoiding the need for `get()` calls in security rules. This supports atomic operations and improves security and debuggability. Structural segregation is used to maintain a homogeneous security posture within collections.\n\n- `/users/{userId}`: Stores user profiles. This is path-based ownership for private user data.\n- `/users/{userId}/items/{itemId}`: Stores items listed by a specific user, enabling easy retrieval of items owned by a user. This structure facilitates simple security rules based on the user ID.\n- `/items/{itemId}`: This collection contains all items listed on the marketplace to support efficient listing and discovery. Includes denormalized `userId` from the parent `/users/{userId}/items/{itemId}` collection to enable list operations based on the user. It denormalizes `userId` for authorization independence.\n- `/sales/{saleId}`: Sales data is stored in a top-level collection to allow for efficient querying and aggregation of sales data across all users. It includes denormalized `itemId`, `buyerId` and `userId` (seller) for authorization independence. This also facilitates reporting and analytics on sales trends.\n- `/pickups/{pickupId}`: Pickup requests are stored in a top-level collection, as they involve interactions between buyers, sellers, and potentially delivery services. It includes denormalized `saleId` for authorization independence.\n- `/ethical_contributions/{contributionId}`: Ethical contributions are stored in a top-level collection for reporting and tracking purposes. It includes denormalized `saleId` for authorization independence.\n\nThis design supports the required QAPs (Queries that Protect) by:\n\n1.  **Authorization Independence:** Denormalizing `userId` into `/items`, `/sales`, `/pickups`, and `/ethical_contributions` collections allows security rules to validate user access without relying on `get()` calls to parent documents.\n2.  **Structural Segregation:** Separating user-owned items from the global `/items` collection allows different security rules to be applied.\n\nThe denormalization strategy ensures that security rules can be written to enforce ownership and access control at each level without complex hierarchical dependencies."
  }
}